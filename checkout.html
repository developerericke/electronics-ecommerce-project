<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Checkout</title>
        <link rel="stylesheet" href="./assests/styles/w3.css">
        <link rel="stylesheet" href="./assests/styles/mobile-view.css">
        <link rel="stylesheet" href="./assests/styles/large-screen.css">
        <script defer src="./assests/scripts/solid.js"></script>
        <script defer src="./assests/scripts/fontawesome.js"></script> 
         <style>
             .testcase{
                 border:3px solid green;
             }
           
         </style>

    
         <script  src="./assests/scripts/url.js"></script>
         <script defer src="./assests/scripts/script.js"></script> 
    </head>
    <body >
         
        <div id="page-wrapper">
            <div id="content-wrapper">
                <div id="sticky-content">
                    <div id="nav-section" class="w3-row">
                        <div id="nav-bar-large"></div>    
                    </div>
                </div>
            <div id="cart-items-wrapper" >    
                <div class="w3-card-2" id="checkout-sect">
                    <div class="w3-panel w3-center w3-large" style="text-decoration: underline;font-size: 2em;">Checkout</div>
                     <input type="text" name="csrf" hidden id="csrf">
                     <div  class="progress-section w3-margin-bottom w3-row w3-center w3-text-black w3-border-bottom">
                      
                            <div class="cart-confirm  progress-item  w3-col s4 l4 "  >
                                <div  style="font-weight: bold;cursor: pointer;" id="cart_itm" class="w3-border w3-small w3-hover-pale-blue">
                                    Cart</i> <br><i  class="fas fa-shopping-cart" ></i>  
                                </div>
                                      
                            </div>
                            
                            <div class="address-section  progress-item w3-col s4 l4"  >
                                <div style="font-weight: bold;cursor:pointer" id="addr_itm" class="w3-border w3-small w3-hover-pale-blue" >
                                    Address <br> <i class="fas fa-map-marker"  ></i>
                                </div> 
                            </div>
                            <div   class="payment-method   progress-item w3-col s4 l4">
                                <div  style="font-weight: bold;cursor: pointer;" id="paym_itm" class="w3-border w3-small w3-hover-pale-blue ">
                                    Payment<br> <i class="fas fa-money-bill-alt" ></i>
                                </div>
                               
                            </div>  
                        
                            
                            
                        
                        



                        

                     </div>

                      <div id="checkoutPreload" class="w3-display-container" >
                       
                            <div class="w3-pale-yellow w3-small w3-center" style="font-weight: bold;color:green">Preparing your Cart .Please Wait ...</div>
                           
                         
                        <div class="w3-display-middle w3-center" style="font-weight: bold;" id="animator-effect">
                           <img src="./assests/images/372.gif" alt="loader">
                        </div>
                         
                     </div>
                
                     <div id="cart-wrapper" style="display:none;">
           
                    <!-- cart -->
                    <div  id="cart-checkout">
                        <div class="w3-margin-top" >
                            <div class="w3-panel w3-center" style="font-weight: bold;text-decoration: underline;">Cart Details</div>
                            <div class="checkout-title w3-center w3-grey">
                                <div class="">Item</div>
                                <div class="">Quantity</div>
                                <div class="">Delete</div>
                                <div class="">Total Price</div>

                            </div>
                        </div>
                    

                        <div  class="cart-section w3-margin-top">
                            <div id="cartItemDisplayRow">
                                    <div></div>
                            </div>
                         
                            

                            
                            <div id="total-amount" style="font-weight: bold;text-decoration: underline;" class="w3-center w3-margin-top">Total Amount <span class="w3-small" >(Shipping Charges Not inc)</span></div>
                            <div class="w3-center w3-text-orange w3-margin-top" style="font-weight: bold;text-decoration:underline">KES <span  id="cartTotal"> 0 </span> </div>
                        
                            <button id="cartOkay" style="font-weight: bold;color:white;color: black;" class="w3-btn w3-margin-bottom w3-border w3-margin-top w3-round w3-center w3-border-green cartProceed">Proceed</button>

                        </div>
                    </div>  
                
                    <!-- address  -->
                        <div id="delivery-address" style="display: none;" class="address-select w3-card w3-border-right w3-border-left w3-border-bottom w3-border-black">
                        <div class="w3-panel w3-border w3-center">Delivery Address</div>
                    

                        <div id="primary-address">
                            <div class="w3-panel w3-center w3-margin-top" style="font-weight: bolder;text-decoration: underline;" >The  Address below will be used for shippment</div>
                            <p style="font-weight: bold;"  class="w3-border w3-text-black">
                              <span>Recipient : <span class="w3-small w3-text-grey addITEM"></span></span>  <br>
                              <span>Phone : <span class="w3-small w3-text-grey addITEM"></span> </span><br>
                              <span>County : <span class="w3-small w3-text-grey addITEM"></span></span> <br>
                              <span>Location : <span class="w3-small w3-text-grey addITEM"></span></span> <br>
                              <span>P.O Box  : <span class="w3-small w3-text-grey addITEM"> </span></span> <br>
                              <span>Station  : <span class="w3-small w3-text-grey addITEM"> </span></span> <br>
                              <span>Location Description : <span class="w3-small w3-text-grey addITEM"></span>   </span> 
                            </p>
                              

                            <button class="w3-btn w3-center w3-margin-bottom w3-small w3-round-large w3-orange w3-text-black">Select A Different Address</button>
                        </div>
                            <button id="pickupSelector" class="w3-btn w3-small w3-round-large w3-center w3-margin-top w3-black w3-text-white w3-margin-bottom ">Use a Pick Up station Instead</button>
                        
                    
                            <div class="totalAmount">
                                <div class="w3-border" id='totSumm' >
                                    <div style="font-weight: bold;" class="w3-center w3-pale-yellow">Charges Summary</div>
                                    <p class="w3-small w3-text-gray" style="text-decoration: underline;font-weight: bold;" > Total Products Charges + vat: Kes <span class='w3-text-gray cost'></span> </p>
                                    <p class="w3-small w3-text-gray" style="text-decoration: underline;font-weight: bold;">Vat : Kes  <span class='w3-text-gray cost'></span></p>
                                    <p class="w3-small w3-text-gray" style="text-decoration: underline;font-weight: bold;">Shipping Charges : Kes  <span class='w3-text-gray cost'></span></p> 
                                    
                                </div>
                               <h4 style="font-weight: bold;">Amount to Pay <span class="w3-small">(inc Shipping)</span> : Kes  <span style="font-weight: bolder;color:#54542b;text-decoration: underline;" class='cost'></span></h4>
                               
                            </div>


                            <button id="addressOkay" style="background-color:white;color:green" class="w3-btn w3-margin-bottom w3-border w3-border-green  w3-round w3-center  checkoutProceed">Proceed To Payment</button>


                    </div>   
                        
                    <!-- payment -->
                    <div  style="display: none;" id='paym_opt'>
                        
                        <div class=" w3-border-right w3-border-left w3-border-bottom w3-border-black" id="payForm">
                            <div style="font-weight:bolder;border:1px dashed green;" class="w3-panel w3-pale-yellow w3-center ">You are about to pay  <span style="font-weight: bolder;text-decoration:underline" id="aboutTOpay"> </span><br><span class="w3-tiny">(Product Totals & shippment Cost) </span></div>
                            
                            <div style="text-decoration: underline;"  class="w3-center w3-medium w3-margin-top ">Choose a Payment Method </div>
                       
                           <div id="paym-methods">
                            <div class="w3-display-container "  id="mpesaOnline">
                                 <p class="w3-center w3-margin-bottom">Pay With Mpesa</p>
                                 
                                
                                            
                             </div>
                             <div class="w3-display-container " id="mpesaonDelivery" >
                                <p class="w3-center">Mpesa on Delivery</p>
                                                   
                            </div>
                            <div class="w3-display-container" id="paypal" >
                                <p class="w3-center">Paypal <br><span aria-disabled="true" class="w3-text-gray w3-tiny w3-center">Unavailable</span></p>
                         
                                           
                            </div>
                           
                            <div class="w3-display-container " id="cashOndelivery" >
                                <p class="w3-center">Cash on Delivery</p>
                             
                                           
                            </div>
                           </div>  
                           <div id="pay-mpesa" style="display: none;" class="w3-sand">
                               <div id="instructions"  class="w3-light-gray">
                                   <span style="font-weight: bolder;">To pay with Mpesa,</span>  
                                   <ul>
                                       <li>Go to Lipa Mpesa </li>
                                       <li>Select Paybill/Buy Goods</li>
                                       <li>Enter Till Number</li>
                                       <li>Enter Amount to Pay (Kes <span  style="font-weight: bolder;text-decoration: underline;" id="amto"></span>)</li>
                                       <li>Enter you Mpesa Pin</li>
                                   </ul>
                               </div>
                               <div id="verify-mpesa-code">
                                   <form action="" method="post">
                                        <label class="w3-small" style="font-weight: bold;color:black" for="code">Enter the Mpesa Transaction Code to Proceed</label><br>
                                       <input class="w3-input w3-margin-bottom w3-border w3-border-gray" placeholder="Mpesa Code" type="text" name="code" id="code">
                                       <button style="font-weight: bold;" class="w3-btn w3-border w3-white w3-border-gray w3-text-green" type="submit">Submit</button>
                                   </form>
                               </div>
                           </div>

                           <div style="display: none;" class="w3-center  w3-sand w3-text-black "  id="cash-on-delivery">
                           </div>
                           


                        
                        </div>
                    </div>
                   
                    </div>
           </div>

                 
                     
           </div>           
            </div>
    
            <div id="footer-wrapper">
                <input type="text" value='0'  class="cartVALUE w3-hide">
               <div id="nav-bar-small"></div>
                <div id="footer-content">
                
                </div>
           
            </div>
        </div>
   
        

    
           <!-- <script src="./assests/scripts/jquery-3.4.1.min.js"></script> -->
           <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
        <script src="./assests/scripts/jquery.connections.js"></script>
        <script >  
     
             
              
            $(document).ready(()=>{
                let bask =(document.cookie).split(';').filter((item)=>{
                 
           
                 if(item.search('verifiedBasket')>-1){
                     
                     return item;
                 }
                 })
                 if(bask.length>0){
                     bask  = bask[0].split('=')[1]
                  }
                 
                 let veradd =(document.cookie).split(';').filter((item)=>{
                      
                      if(item.search('verifiedAddress')>-1){
                          
                          return item;
                      }
                   })
                    if(veradd.length>0){
                     veradd  = veradd[0].split('=')[1]
                    }
     
                    let verifTotal=(document.cookie).split(';').filter((item)=>{
                      
                      if(item.search('verifiedTotalAmount')>-1){
                          
                          return item;
                      }
                   })
                    if(verifTotal.length>0){
                     verifTotal  =   verifTotal[0].split('=')[1]
                    }
                   

                $('#cart_itm').connections({
                    to:'#addr_itm',
                    'class': 'testcase'
                })
                $('#addr_itm').connections({
                    to:'#paym_itm',
                    'class': 'testcase'
                })
                $('#mpesaOnline').click(function(){
                
                    let topayout =(document.cookie).split(';').filter((item)=>{
                 
                 if(item.search('topayout')>-1){
                     
                     return item;
                 }
              })
              
               if(topayout.length>0){
                topayout  =  topayout[0].split('=')[1]
               }
               $('#amto').html(topayout)
                    $('#pay-mpesa').toggle(200)
                    $('#cash-on-delivery').hide()
               
                    $('#mpesaOnline').append('<i style="display: block;" class="fas fa-check w3-display-middle"></i>').css({'background-color':'#ccffcc',"border":"2px solid green"})
                    $('#mpesaonDelivery').html( '<p class="w3-center">Mpesa on Delivery</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#cashOndelivery').html( '<p class="w3-center">Cash on Delivery</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#paypal').html( '<p class="w3-center">Paypal</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                  
                })
                $('#pay-mpesa').submit((e)=>{
                    e.preventDefault();
                    $('#pay-mpesa label').css({"color":"black"})
                    $('#pay-mpesa label').html('Enter the Mpesa Transaction Code to Proceed')
                 
                    if($('#pay-mpesa input').val() ==='' || $('#pay-mpesa input').val().length<5 ){
                        $('#pay-mpesa label').css({'color':'red'})
                        $('#pay-mpesa label').html('Enter A valid Mpesa Code')
                    }else{
                        $('#pay-mpesa label').css({"color":"green"})
                        $('#pay-mpesa label').html('<span class="w3-small">Verifying Mpesa Transaction Code </span><img class="loadgif-mpesaOkay" src="./assests/images/328.gif" alt="loader">')
                        $('#pay-mpesa button').attr('disabled',true)

                        let formdata =$('#verify-mpesa-code form').serialize()
                     

                       
                        $.ajax({
                            method:'POST',
                            url:post_mpesa_online,
                            data:formdata+"&_csrf="+$('#csrf').val()+"&address="+veradd+"&basket="+bask+"&verifiedTotal="+verifTotal,
                            xhrFields:{
                              withCredentials:true

                            },
                            success : function(data,status,xhr){
                               if(xhr.status===200){
                                $('#pay-mpesa label').css({'color':'green'})
                                 $('#pay-mpesa label').html('Mpesa Transaction Code Verified  <i class="fas fa-check"></i>')
                                  localStorage.removeItem('basketDetails')
                               localStorage.removeItem('navigationTrack')
                               localStorage.removeItem('cartOkay')
                               localStorage.removeItem('addressOkay')
                               localStorage.removeItem('selectedAddress')
                               document.cookie = "curruser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "locationID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "cartTotal=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = " VAT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                                 window.location.href='receipt.html?verify-code='+ data
                              
                               } 
                            },
                            error: function(xhr,status,error){
                              if(xhr.status===0){
                                $('#pay-mpesa label').css({'color':'red'})
                                 $('#pay-mpesa label').html('Oops. You seem to have lost your internet connection')
                                 $('#pay-mpesa button').attr('disabled',false)
                               }else if(xhr.status===403){
                                $('#pay-mpesa label').css({'color':'red'})
                                 $('#pay-mpesa label').html(xhr.responseText)
                                 $('#pay-mpesa button').attr('disabled',false)
                               }else if(xhr.status==401){
                                 window.location.href=authenticate
                               }else{
                                $('#pay-mpesa label').css({'color':'red'})
                                 $('#pay-mpesa label').html(xhr.responseText)
                                 $('#pay-mpesa button').attr('disabled',false)
                               }
                            
                            }
                            
                        })
                    }

                })


                $('#mpesaonDelivery').click(()=>{
                    let topayout =(document.cookie).split(';').filter((item)=>{
                 
                 if(item.search('topayout')>-1){
                     
                     return item;
                 }
              })
               if(topayout.length>0){
                topayout  =  topayout[0].split('=')[1]
               }
                    
                    $('#cashOndelivery').html( '<p class="w3-center">Cash on Delivery</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#paypal').html( '<p class="w3-center">Paypal</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#mpesaOnline').html( '<p class="w3-center">Pay with Mpesa</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#mpesaonDelivery').css({'background-color':'#ccffcc',"border":"2px solid green"}).append('<i style="display: block;" class="fas fa-check w3-display-middle "></i>')
                    $('#pay-mpesa').hide()
                    
                    if($('#cash-on-delivery').css('display')==='none'){
                        $('#cash-on-delivery').toggle(200,()=>{ 
                            $('#cash-on-delivery').html('You payment method is <span style="text-decoration:underline;font-weight:bold;color:#003300">"MPESA ON DELIVERY"</span>. <br> You will Pay <span style="font-weight: bold;text-decoration:underline">KES '+topayout+'</span> through Mpesa when you collect your '+
                          '  items at your delivery address<br><br>'+
                            '<button style="font-weight: bold;background-color:green" class="w3-btn w3-border w3-border-green w3-text-black">Proceed</button>')
                            $('#cash-on-delivery button').click(()=>{
                  
                                $('#cash-on-delivery button').css({'background-color':'white'}).html('<span class="w3-small">Processing </span><img class="loadgif-button" src="./assests/images/328.gif" alt="loader">')
                                $.ajax({
                            method:'POST',
                            url:post_pay_on_delivery,
                            data:'paymentoption=MpesaOndelivery&_csrf='+$('#csrf').val()+"&address="+veradd+"&basket="+bask+"&verifiedTotal="+verifTotal,
                            xhrFields:{
                                withCredentials:true
                            },
                            success : function(data,status,xhr){
                                if(xhr.status===200){
                                    $('#cash-on-delivery button').html('Success. Payment Method Accepted.').css({'color':'black','background-color':'lightgreen'}).attr('disabled',true)
                          
                                localStorage.removeItem('basketDetails')
                               localStorage.removeItem('navigationTrack')
                               localStorage.removeItem('cartOkay')
                               localStorage.removeItem('addressOkay')
                               localStorage.removeItem('selectedAddress')
                               document.cookie = "curruser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "locationID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "cartTotal=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = " VAT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; 
                                window.location.href='receipt.html?verify-code='+ data

                                }
                              
                            },
                            error: function(xhr,status,err){
                            if(xhr.status==401){
                              window.location.href= authenticate
                            }else{
                                $('#cash-on-delivery button').html(xhr.responseText).css({'color':'red','background-color':'white'}).fadeOut(5000,()=>{
                                    $('#cash-on-delivery button').fadeIn(1000).css({'color':'black','background-color':'green'}).html('Proceed')
                                })
                            }
                               
                               

                            }
                        })  
                       
                       
                            })
                      
                      
                        })

                       
                    
                    }else{
                        let topayout =(document.cookie).split(';').filter((item)=>{
                 
                 if(item.search('topayout')>-1){
                     
                     return item;
                 }
              })
               if(topayout.length>0){
                topayout  =  topayout[0].split('=')[1]
               }

                        $('#cash-on-delivery').html('You payment method is <span style="text-decoration:underline;font-weight:bold;color:#003300">"MPESA ON DELIVERY"</span>. <br> You will Pay <span style="font-weight: bold;text-decoration:underline">KES '+topayout+'</span> through Mpesa when you collect your '+
                          '  items at your delivery address<br><br>'+
                            '<button style="font-weight: bold;background-color:green" class="w3-btn  w3-border w3-border-green w3-text-black">Proceed</button>')
                            $('#cash-on-delivery button').click(()=>{
                                $('#cash-on-delivery button').css({'background-color':'white'}).html('<span class="w3-small">Processing </span><img class="loadgif-button" src="./assests/images/328.gif" alt="loader">')
                       
                  
                                $.ajax({
                            method:'POST',
                            url:post_pay_on_delivery,
                            xhrFields:{
                                withCredentials:true
                            },
                            data:'paymentoption=MpesaOndelivery&_csrf='+$('#csrf').val(),
                            success : function(data,status,xhr){
                                $('#cash-on-delivery button').html('Success').css({'color':'black','background-color':'lightgreen'}).attr('disabled',true)
                                localStorage.removeItem('basketDetails')
                               localStorage.removeItem('navigationTrack')
                               localStorage.removeItem('cartOkay')
                               localStorage.removeItem('addressOkay')
                               localStorage.removeItem('selectedAddress')
                               document.cookie = "curruser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "locationID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "cartTotal=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = " VAT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; 
                                window.location.href='receipt.html?verify-code='+ data

                            },
                            error: function(xhr,status,err){
                                $('#cash-on-delivery button').html(this.responseText).css({'color':'red','background-color':'white'}).fadeOut(2000,()=>{
                                    $('#cash-on-delivery button').css({'color':'black','background-color':'green'}).html('Proceed').fadeIn(500)
                                })
                               

                            }
                        })  
                       
                       
                            })
                      
                      
                      
                    }
                   

                 
                })
                $('#cashOndelivery').click(()=>{
                    let topayout =(document.cookie).split(';').filter((item)=>{
                 
                 if(item.search('topayout')>-1){
                     
                     return item;
                 }
              })
               if(topayout.length>0){
                topayout  =  topayout[0].split('=')[1]
               }
                    $('#mpesaOnline').html( '<p class="w3-center">Pay With Mpesa</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#mpesaonDelivery').html( '<p class="w3-center">Mpesa on Delivery</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                    $('#cashOndelivery').append('<i style="display: block;" class="fas fa-check w3-display-middle "></i>').css({'background-color':'#ccffcc',"border":"2px solid green"})
                    $('#paypal').html( '<p class="w3-center">Paypal</p>').css({'background-color':'white',"border":"2px solid lightblue"})
                  
                    $('#pay-mpesa').hide()
                    if(  $('#cash-on-delivery').css('display')==='none'){
                        $('#cash-on-delivery').toggle(200,()=>{
                   
                            $('#cash-on-delivery').html('You payment method is <span style="text-decoration:underline;font-weight:bold;color:#006666">"CASH ON DELIVERY"</span>. <br> You will Pay <span style="font-weight: bold;text-decoration:underline">KES '+topayout+'</span> cash when you collect your '+
                          '  items at your delivery address<br><br>'+
                            '<button style="font-weight: bold;color:black;background-color:green"  id="cashONDelivery" class="w3-btn  w3-border w3-border-green">Proceed</button>')
                            $('#cash-on-delivery button').click(()=>{
                        
                                $('#cash-on-delivery button').css({'background-color':'white'}).html('<span class="w3-small">Processing </span><img class="loadgif-button" src="./assests/images/328.gif" alt="loader">')
                       
                        $.ajax({
                            method:'POST',
                            url:post_pay_on_delivery,
                            xhrFields:{
                                withCredentials:true
                            },
                            data:'paymentoption=cashOndelivery&_csrf='+$('#csrf').val()+"&address="+veradd+"&basket="+bask+"&verifiedTotal="+verifTotal,
                            success : function(data,status,xhr){
                                if(xhr.status===200){
                                    $('#cash-on-delivery button').css({'color':'black','background-color':'lightgreen'}).html('Success')
                                localStorage.removeItem('basketDetails')
                               localStorage.removeItem('navigationTrack')
                               localStorage.removeItem('cartOkay')
                               localStorage.removeItem('addressOkay')
                               localStorage.removeItem('selectedAddress')
                               document.cookie = "curruser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "locationID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "cartTotal=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = " VAT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; 
                                window.location.href='receipt.html?verify-code='+ data
                                }
                          

                            },
                            error: function(xhr,status,err){
                                if(xhr.status===401){
                                    window.location.href = authenticate
                                }else{
                                    $('#cash-on-delivery button').css({'color':'red','background-color':'white'}).html(xhr.responseText).fadeOut(5000,()=>{
                                    $('#cash-on-delivery button').fadeIn(500).css({'color':'black','background-color':'green'}).html('Proceed')
                                })
                                }
                               
                               

                            }
                        })  
            
                       
                       })
                    })
                  
                     
                    }else{
                        let topayout =(document.cookie).split(';').filter((item)=>{
                 
                 if(item.search('topayout')>-1){
                     
                     return item;
                 }
              })
               if(topayout.length>0){
                topayout  =  topayout[0].split('=')[1]
               }
                        $('#cash-on-delivery').html('You payment method is <span style="text-decoration:underline;font-weight:bold;color:#006666">"CASH ON DELIVERY"</span>. <br> You will Pay <span style="font-weight: bold;text-decoration:underline">KES '+topayout+'</span> cash when you collect your '+
                          'items at your delivery address<br><br>'+
                            '<button  style="font-weight: bold;background-color:green" id="cashONDelivery" class="w3-btn w3-border w3-border-green w3-text-black">Proceed</button>')   
                     
                     $('#cash-on-delivery button').click(()=>{
                     
                        $('#cash-on-delivery button').css({'background-color':'white'}).html('<span class="w3-small">Processing </span><img class="loadgif-button" src="./assests/images/328.gif" alt="loader">')
                       
                       $.ajax({
                            method:'POST',
                            url:post_pay_on_delivery,
                            xhrFields:{
                                withCredentials:true
                            },
                            data:'paymentoption=cashOndelivery&_csrf='+$('#csrf').val(),
                            success : function(data,status,xhr){
                                if(xhr.status==200){
                                    $('#cash-on-delivery button').css({'color':'black','background-color':'lightgreen'}).html('Success')
                                localStorage.removeItem('basketDetails')
                               localStorage.removeItem('navigationTrack')
                               localStorage.removeItem('cartOkay')
                               localStorage.removeItem('addressOkay')
                               localStorage.removeItem('selectedAddress')
                               document.cookie = "curruser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "locationID=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = "cartTotal=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                               document.cookie = " VAT=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                                window.location.href='receipt.html?verify-code='+ data
                                }
                       

                            },
                            error: function(xhr,status,err){
                                if(xhr.status===401){
                                    window.location.href = authenticate
                                }else{
                                    $('#cash-on-delivery button').html('An Error Occured : '+xhr.responseText).css({'color':'red','background-color':'white'}).fadeOut(7000,()=>{
                                    $('#cash-on-delivery button').fadeIn(500).css({'color':'black','background-color':'green'}).html('Proceed')
                                })
                                }
                              
                               

                            }
                        })  
                       
                       

                     })


                   }
                  


                   

                  
                }) 
             

            })
        </script>
       
    </body>
    </html>